// autoCreateAndDraftNote.js
// 薄いラッパー：既存のCLI引数・動作は維持しつつ、実装は共有ライブラリに委譲

import { runWithCore } from '@aa-0921/note-auto-core';

// アフィリエイト設定とリンクを別ファイルから読み込み
import { affiliateConfig, affiliateLinks } from './affiliateConfig.js';

// 再エクスポート（他のファイルから参照できるように）
export { affiliateConfig, affiliateLinks };

(async () => {
  await runWithCore(async ({ core, wantsBackground }) => {
    // アカウント固有の題材・切り口（チョウピラコ様関連）
    const topics = [
      'チョウピラコ様のすごさ',
      '座敷わらしの最上位チョウピラコ',
      'チョウピラコ様がもたらす幸運',
      'チョウピラコ様のご利益',
      'チョウピラコ様を信じることの大切さ',
      '座敷わらしの種類とランク',
      'チョウピラコ様のパワー',
      'チョウピラコ様を迎える方法',
      'チョウピラコ様の恩恵',
      '座敷わらしの伝承',
      'チョウピラコ様と運気上昇',
      'チョウピラコ様と富の関係',
      'チョウピラコ様の右肩上がり現象',
      'チョウピラコ様と袖引き様',
      '感謝の気持ちとチョウピラコ様',
      'チョウピラコ様を宿らせた人形',
      'チョウピラコ様と水晶玉',
      'チョウピラコ様の御霊分け',
      'チョウピラコ様のお名前の重要性',
      'チョウピラコ様と体調改善',
      'チョウピラコ様と不眠症改善',
      'チョウピラコ様とストレス緩和',
      'チョウピラコ様と恋愛成就',
      'チョウピラコ様と結婚',
      'チョウピラコ様と臨時収入',
      'チョウピラコ様と宝くじ当選',
      'チョウピラコ様と転職成功',
      'チョウピラコ様と内定合格',
      'チョウピラコ様とボーナスUP',
      // 具体的な情報を追加
      '奥座敷に住む色の白い座敷童子',
      'コメツキワラシとノタバリコとウスツキコ',
      'クラワラシと細手とカブキレワラシ',
      '岩手県を中心とした東北地方の伝承',
      '遠野物語と座敷わらし',
      '十方庵遊歴雑記の記述',
      '座敷童子がいる家は栄える',
      // '座敷童子の去った家は衰退する',
      '白い座敷童子は吉事の前触れ',
      '赤い童子は凶事の前触れ',
      '小豆飯が好物の座敷童子',
      '毎日膳を供える風習',
      '床下に金の玉を埋める伝承',
      'こけしに宿るチョウピラコ様',
      'うさぎの人形に宿るチョウピラコ様',
      '水晶玉がご神体',
      'こけしと水晶の相乗効果',
      '座敷わらし縁の地へ赴く',
      '祝詞を唱えて御霊を写す',
      '神聖なオーブが大量に舞う',
      '5歳くらいの可愛い女の子',
      'お名前を付けると別の人格を持つ',
      'ご自宅に居着いてくれる',
      'ご祈祷し波動を合わせる',
      // '綺麗に梱包して浄化',
      // '柳田國男の遠野物語',
      // '佐々木喜善のザシキワラシの話',
      // '座敷童と座敷童衆と座敷ぼっこ',
      // '秋田の三吉鬼と座敷童子',
    ];

    const patterns = [
      '知られざる真実',
      '驚きの効果',
      '体験談から学ぶ',
      'なぜ効果があるのか',
      '信じることの大切さ',
      '実際に起きた変化',
      '成功例から学ぶ',
      'よくある質問に答える',
      '正しいお迎えの方法',
      '効果を高めるコツ',
      '感謝の気持ちの重要性',
      // '体験者の声',
      // '効果が出る時期',
      // '個人差について',
      'お名前を付ける意味',
      '御霊分けの効果',
      '水晶玉との相乗効果',
      '人形に宿る力',
      '座敷わらしの伝承',
      '最上位の座敷童子',
      '右肩上がりの現象',
      '袖引き様の前触れ',
      '富をもたらす力',
      '運気上昇の秘訣',
      '体調改善の報告',
      '不眠症改善の実例',
      'ストレス緩和の効果',
      '恋愛成就の体験',
      '結婚に導く力',
      '臨時収入のご褒美',
      '宝くじ当選のご褒美',
      '転職成功の体験',
      '内定合格へ向けた効果',
      'ボーナスUPのご利益',
      '感謝することで得られる恩恵',
      '信じる心の力',
      'スピリチュアルな体験',
      '波動を合わせる方法',
      'ご祈祷の重要性',
      '浄化の意味',
    ];

    const rewriteConditionsLines = [
      'あなたはスピリチュアルな世界に詳しい専門家です。',
      '指定の見出し本文が短いため、200文字以上になるようチョウピラコ様に関する知識、伝承、効果、体験談を交えて厚くリライトしてください。',
      '【注意】',
      '- タイトルや見出しは出力せず、本文のみを返す。',
      '- メタ情報（追加要素や文字数など）は一切出力しない。',
      '- 丁寧な敬語（です・ます）で、読みやすさ重視。',
      '- 絵文字を多めに、各行に1つ程度。',
      '- 元の内容に沿い、noteのMarkdownのみ使用。',
      '- 箇条書きは「・ 」、番号付きリストは使わない。',
      '- 特殊トークンや制御文字（<|begin_of_sentence|>等）は絶対に出力しない。',
      '- 自然で読みやすい日本語のみを出力する。',
      '- 完成した文章のみを返し、システムメッセージや処理情報は含めない。',
      '- 日本語の文章の中に英単語を混ぜないでください。すべて日本語で表現してください。',
      '- 絵文字を使用する場合、その直前と直後に句読点（。や、）を置かないでください（例：「ありがとうございます✨」「ありがとうございます。」は可、「ありがとうございます。✨」「ありがとうございます、✨」は不可）。',
      '- チョウピラコ様のすごさ、効果、メリット、信じることの大切さを強調してください。',
    ];

    // LLM用システムプロンプト（チョウピラコ様専門）
    const systemMessage = 'あなたはチョウピラコ様や座敷わらし、スピリチュアルな世界に詳しい日本語のnote記事編集者です。';

    // 記事生成プロンプト条件（チョウピラコ様専門）
    const articleConditionsLines = [
      'タイトル、本文、ハッシュタグ（#から始まるもの）を含めてください。',
      'タイトルは1行目に「# [実際のタイトル]」として記載してください。',
      '「# タイトル」という文字列ではなく、実際の記事タイトルを入れてください。',
      '本文にはタイトルを含めないでください。',
      '本文は見出しや箇条書きも交えて1000文字程度で丁寧にまとめてください。',
      'ハッシュタグは記事末尾に「#〇〇 #〇〇 ...」の形式でまとめてください。',
      'あなたはチョウピラコ様や座敷わらし、スピリチュアルな世界に詳しい専門家です。',
      '読みやすさを重視してください。',
      'チョウピラコ様のすごさ、効果、メリット、信じることの大切さを強調してください。',
      '座敷わらしの伝承や歴史的背景も含めてください。',
      '改行を多めに入れてください。',
      '各行に1つ程度、絵文字を使用してください。',
      'すべて日本語で出力してください。',
      '切り口に沿った内容にしてください。',
      'noteの正しいマークダウン記法のみを使ってください。',
      '箇条書きはマークダウンではなく、「・ 」で表現してください。',
      '見出しはh2（## 見出し）・h3（### 見出し）のみ。',
      '見出しに「**」等は使わないでください。',
      '番号付きリストは使わないでください。',
      'h1（# タイトル）はタイトル行のみで本文中では使わないでください。',
      'その他のマークダウンやHTMLタグは使わないでください。',
      '【重要】特殊トークンや制御文字（<|begin_of_sentence|>、<｜begin▁of▁sentence｜>等）は絶対に出力しないでください。',
      '【重要】自然で読みやすい日本語のみを出力し、システムメッセージや処理情報は一切含めないでください。',
      '【重要】完成した記事のみを返してください。',
      '【重要】日本語の文章の中に英単語を混ぜないでください。すべて日本語で表現してください。',
      '【重要】絵文字を使用する場合、その直前と直後に句読点（。や、）を置かないでください（例：「ありがとうございます✨」「ありがとうございます。」は可、「ありがとうございます。✨」「ありがとうございます、✨」は不可）。',
      '【重要】チョウピラコ様.mdの内容を参照して、正確な情報を記載してください。',
    ];

    // タグ生成の指示文（チョウピラコ様関連タグ）
    const tagsInstruction =
      '記事内容から最も関連する日本語タグを3〜5個生成し、半角スペース区切りで出力してください。必ず「#チョウピラコ #座敷わらし #スピリチュアル #引き寄せの法則」を含めてください。本文や説明は禁止。';

    // フォールバックタグ（タグ生成失敗時に使用されるタグ）
    const fallbackTags = [
      '#チョウピラコ',
      '#座敷わらし',
      '#スピリチュアル',
      '#引き寄せの法則',
      '#幸運',
    ];

    // タイトル装飾用絵文字（チョウピラコ様・スピリチュアル関連）
    const titleEmojis = [
      '✨',
      '🌟',
      '💫',
      '🔮',
      '🦋',
      '🌸',
      '💖',
      '🕯️',
      '🌙',
      '⭐',
      '💎',
      '🎋',
    ];

    // ----------------------------------------------------------------------------------

    // // チョウピラコ様商品の誘導文（現在は未使用のためコメントアウト）
    // const magazinePromotion = [
    //   '✨　🌟　✨　🌟　✨　🌟　✨　🌟　✨　🌟　✨　🌟　✨　🌟　✨',
    //   '',
    //   'チョウピラコ様の魂が宿る商品をメルカリで販売しております✨',
    //   '',
    //   'チョウピラコ様は座敷わらしの最上位の存在で、',
    //   '色の白い最も美しい座敷童子として知られています🌟',
    //   '',
    //   '【チョウピラコ様の商品】',
    //   '✔ ご祈祷済み・波動を合わせた商品',
    //   '✔ 綺麗に梱包・浄化済み',
    //   '✔ あなたの願いを込めて発送',
    //   '',
    //   'チョウピラコ様を迎えることで、',
    //   '体調改善、不眠症改善、ストレス緩和、',
    //   '恋愛成就、結婚、臨時収入、宝くじ当選、',
    //   '転職成功、内定合格、ボーナスUPなど、',
    //   '様々な幸運がもたらされると伝えられています💫',
    //   '',
    //   '感謝の気持ちを忘れずにいることで、',
    //   'より多くの幸運がもたらされます✨',
    //   '',
    //   '✨　🌟　✨　🌟　✨　🌟　✨　🌟　✨　🌟　✨　🌟　✨　🌟　✨',
    //   '',
    // ].join('\n');

    // アソシエイト表記文（メルカリ販売のため不要だが、形式を維持）
    const amazonAssociateText = '';

    // 締めの文章（infoText：タグの直前に挿入される案内文）
    // 引数から渡された場合はそれを採用、渡されていない場合はデフォルト値を使用
    const infoText = [
      '最後までお読みいただき、ありがとうございます✨',
      'チョウピラコ様のご縁に感謝し、',
      'これからも幸運と繁栄についてお伝えしていきます💫',
      'スキやフォローをいただけると、とても嬉しいです🙏',
    ].join('\n');

    // // おすすめ記事セクションの設定
    // const recommendedArticlesTitle = 'ぜひ読んでほしい🙇‍♂️他のおすすめ記事💕';
    // const recommendedArticlesUrls = [
    //   'https://note.com/counselor_risa/n/ncbb004d39d34', // TODO: リポジトリ用にnoteアカウント名を変更してください
    //   'https://note.com/counselor_risa/n/nf12c80060c09', // TODO: リポジトリ用にnoteアカウント名を変更してください
    //   'https://note.com/counselor_risa/n/n4c94cbc5b40a', // TODO: リポジトリ用にnoteアカウント名を変更してください
    //   'https://note.com/counselor_risa/n/na8e2a969b19f', // TODO: リポジトリ用にnoteアカウント名を変更してください
    // ];

    // 記事の自動生成と下書き保存機能を実行
    await core.runAutoCreateAndDraftNote({
      background: wantsBackground,
      topics,
      patterns,
      systemMessage,
      articleConditionsLines,
      rewriteConditionsLines,
      tagsInstruction,
      fallbackTags, // フォールバックタグ（タグ生成失敗時に使用）
      titleEmojis,
      // affiliateLink,
      affiliateLinks: [], // アフィリエイトリンクをオフ
      magazinePromotion: [], // マガジン誘導をオフ
      amazonAssociateText,
      infoText, // 締めの文章（タグの直前に挿入される案内文）
      // Audible・Kindleアフィリエイト設定（オフ）
      affiliateTag: affiliateConfig.affiliateTag,
      audibleAffiliateEnabled: false, // Audibleリンクをオフ
      kindleAffiliateEnabled: false, // Kindleリンクをオフ
      // おすすめ記事セクション設定（コメントアウト）
      // recommendedArticlesTitle,
      // recommendedArticlesUrls,
    });
    console.log('記事の自動生成と下書き保存が完了しました');
  });
})();
